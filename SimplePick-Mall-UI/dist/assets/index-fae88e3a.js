/* empty css             *//* empty css                  *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                   *//* empty css                *//* empty css                     */import{at as C,d as oe,a as u,r as se,aa as ne,a7 as f,o as re,c as ie,e as l,w as a,f as r,M as b,h as c,t as N,F as de,K as P,k as ue,m as pe,n as ce,p as me,a5 as fe,al as _e,am as ge,an as ve,ao as ye,ap as he,au as ke,as as we,q as be,s as Ce,_ as Ve}from"./index-bc94ad6c.js";import{u as xe}from"./setting-343fd123.js";const ze=(i,d,h)=>C.get("/api/sys/role/list",{params:{current:i,pageSize:d,name:h}}),Ee=i=>i.id?C.post("/api/sys/role/update",i):C.post("/api/sys/role/add",i),Re=()=>C.post("/api/sys/menu/list"),Ie=i=>C.post("/api/sys/role/queryMenuByRoleId",i),qe=i=>C.post("/api/sys/role/updateRoleMenu",i),A=i=>C.post("/api/sys/role/delete",i),Se=i=>(be("data-v-cf275dc4"),i=i(),Ce(),i),Me=Se(()=>N("h4",null,"分配菜单与按钮的权限",-1)),Ue={style:{flex:"auto"}},De=oe({__name:"index",setup(i){let d=u(1),h=u(10),S=u(0),k=u(""),m=u(!1),V=u([]),p=se({name:"",remark:""}),x=u(),_=u(!1),E=u([]),R=u([]),I=u([]),q=u(),M=xe();ne(()=>{w()});let z=u([]);const w=async(o=1)=>{d.value=o;let e=await ze(d.value,h.value,k.value);e.code===200?(S.value=e.total,z.value=e.data,f({type:"success",message:e.message})):f({type:"error",message:e.message})},B=()=>{w()},T=()=>{w(),k.value=""},j=()=>{M.refresh=!M.refresh},F=()=>{m.value=!0,Object.assign(p,{name:"",remark:"",id:0}),P(()=>{x.value.clearValidate("name")})},O=o=>{m.value=!0,Object.assign(p,o),P(()=>{x.value.clearValidate("name")})},H={name:[{required:!0,trigger:"blur",validator:(o,e,s)=>{console.log(o),e.trim().length>=2?s():s(new Error("角色名称至少两位"))}}]},K=async()=>{await x.value.validate();let o=await Ee(p);o.code===200?(m.value=!1,w(p.id?d.value:1),f({type:"success",message:o.message})):f({type:"error",message:o.message})},L=async o=>{E.value="",R.value=[],_.value=!0,Object.assign(p,o);let e=await Re();e.code==200&&(E.value=e.data);let s=await Ie({id:o.id});s.code===200&&(R.value=$(e.data,s.data))};function $(o,e){const s=[],g=n=>{for(const v of n)e.includes(v.id)&&v.children.length===0&&s.push(v.id),v.children&&v.children.length>0&&g(v.children)};return g(o),s}const G={children:"children",label:"name"},J=async()=>{const o=p.id;let e=q.value.getCheckedKeys(),s=q.value.getHalfCheckedKeys(),g=e.concat(s),n=await qe({roleId:o,menuIds:g});n.code===200?(_.value=!1,window.location.reload(),f({type:"success",message:n.message})):f({type:"error",message:n.message})},Q=async o=>{V.value.push(o);const e={ids:V.value};let s=await A(e);s.code===200?(w(z.value.length>1?d.value:d.value-1),f({type:"success",message:s.message})):f({type:"error",message:s.message})},W=o=>{I.value=o},X=async()=>{V.value=I.value.map(s=>s.id);const o={ids:V.value};let e=await A(o);e.code===200?(V.value=[],w(z.value.length>1?d.value:d.value-1),f({type:"success",message:e.message})):f({type:"error",message:e.message})};return(o,e)=>{const s=ue,g=pe,n=ce,v=me,U=fe,y=_e,Y=ge,Z=ve,ee=ye,le=he,ae=ke,te=we;return re(),ie(de,null,[l(U,{style:{height:"80px"}},{default:a(()=>[l(v,{inline:!0,class:"form"},{default:a(()=>[l(g,{label:"角色:"},{default:a(()=>[l(s,{placeholder:"请你输入搜索角色名称",modelValue:r(k),"onUpdate:modelValue":e[0]||(e[0]=t=>b(k)?k.value=t:k=t)},null,8,["modelValue"])]),_:1}),l(g,null,{default:a(()=>[l(n,{type:"primary",size:"default",disabled:!r(k),onClick:T},{default:a(()=>[c(" 搜索 ")]),_:1},8,["disabled"]),l(n,{size:"default",onClick:j},{default:a(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(U,null,{default:a(()=>[l(n,{type:"success",size:"default",icon:"Plus",onClick:F},{default:a(()=>[c(" 添加 ")]),_:1}),l(n,{type:"danger",size:"default",onClick:X,disabled:!r(I).length},{default:a(()=>[c(" 批量删除 ")]),_:1},8,["disabled"]),l(Z,{border:"",style:{margin:"15px 0"},data:r(z),onSelectionChange:W},{default:a(()=>[l(y,{type:"selection",align:"center",width:"40px"}),l(y,{label:"ID",align:"center",prop:"id",width:"50px"}),l(y,{label:"角色名称",align:"center","show-overflow-tooltip":"",prop:"name"}),l(y,{label:"创建者",align:"center","show-overflow-tooltip":"",prop:"create_by"}),l(y,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"create_at"}),l(y,{label:"更新者",align:"center","show-overflow-tooltip":"",prop:"update_by"}),l(y,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"update_at"}),l(y,{label:"备注",align:"center","show-overflow-tooltip":"",prop:"remark"}),l(y,{label:"操作",width:"280px",align:"center"},{default:a(({row:t})=>[l(n,{size:"small",type:"warning",icon:"User",onClick:D=>L(t)},{default:a(()=>[c(" 分配权限 ")]),_:2},1032,["onClick"]),l(n,{type:"primary",size:"small",icon:"Edit",onClick:D=>O(t)},{default:a(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),l(Y,{title:`你确定要删除${t.name}?`,width:"260px",onConfirm:D=>Q(t.id)},{reference:a(()=>[l(n,{type:"danger",size:"small",icon:"Delete"},{default:a(()=>[c(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(ee,{"current-page":r(d),"onUpdate:currentPage":e[1]||(e[1]=t=>b(d)?d.value=t:d=t),"page-size":r(h),"onUpdate:pageSize":e[2]||(e[2]=t=>b(h)?h.value=t:h=t),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper , ->, sizes, total, ",total:r(S),onCurrentChange:w,onSizeChange:B},null,8,["current-page","page-size","total"])]),_:1}),l(le,{modelValue:r(m),"onUpdate:modelValue":e[6]||(e[6]=t=>b(m)?m.value=t:m=t),title:r(p).id?"更新":"添加"},{footer:a(()=>[l(n,{size:"default",onClick:e[5]||(e[5]=t=>b(m)?m.value=!1:m=!1)},{default:a(()=>[c("取消")]),_:1}),l(n,{type:"primary",size:"default",onClick:K},{default:a(()=>[c("确定")]),_:1})]),default:a(()=>[l(v,{model:r(p),rules:H,ref_key:"form",ref:x},{default:a(()=>[l(g,{label:"角色名称",prop:"name"},{default:a(()=>[l(s,{placeholder:"请你输入角色名称",modelValue:r(p).name,"onUpdate:modelValue":e[3]||(e[3]=t=>r(p).name=t)},null,8,["modelValue"])]),_:1}),l(g,{label:"备注",prop:"remark"},{default:a(()=>[l(s,{placeholder:"请你输入角色名称",modelValue:r(p).remark,"onUpdate:modelValue":e[4]||(e[4]=t=>r(p).remark=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(te,{modelValue:r(_),"onUpdate:modelValue":e[8]||(e[8]=t=>b(_)?_.value=t:_=t)},{header:a(()=>[Me]),default:a(()=>[l(ae,{ref_key:"tree",ref:q,data:r(E),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(R),props:G},null,8,["data","default-checked-keys"])]),footer:a(()=>[N("div",Ue,[l(n,{onClick:e[7]||(e[7]=t=>b(_)?_.value=!1:_=!1)},{default:a(()=>[c("取消")]),_:1}),l(n,{type:"primary",onClick:J},{default:a(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Ye=Ve(De,[["__scopeId","data-v-cf275dc4"]]);export{Ye as default};
