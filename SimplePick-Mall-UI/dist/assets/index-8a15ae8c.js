/* empty css             *//* empty css                             *//* empty css                  *//* empty css                    *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                        *//* empty css                      *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                *//* empty css                     */import{at as L,d as Te,a as n,r as qe,aa as Me,a7 as m,b as Re,A as Be,o as A,c as Y,e,w as t,f as o,M as v,h as d,C as Q,t as I,z as Oe,x as W,F as je,K as Fe,k as Ge,m as He,n as Le,p as Je,a5 as Ke,ay as Ye,al as Qe,P as We,am as Xe,an as Ze,ao as $e,aj as el,ak as ll,G as al,ac as tl,ap as ol,ad as sl,ae as nl}from"./index-bc94ad6c.js";import{a as rl,r as pe}from"./index-0e4c8d23.js";import{u as pl}from"./setting-343fd123.js";import{r as il,R as ul}from"./index-66e03b3b.js";const dl=(y,R,g,S,B,h)=>L.get("/api/pms/place/list",{params:{current:y,pageSize:R,name:g,place:S,phone:B,principal:h}}),ie=y=>L.post("/api/pms/place/delete",y),X=y=>y.id?L.post("/api/pms/place/update",y):L.post("/api/pms/place/add",y),cl=["src"],ml=["src"],fl={style:{flex:"auto"}},gl=["src"],vl=["src"],_l=["src"],yl=["src"],hl={key:0,style:{flex:"auto"}},Fl=Te({__name:"index",setup(y){let R=pl(),g=n(1),S=n(10),B=n(0),h=n(1),N=n(5),O=n(0),j=n([]),x=n(""),z=n(""),U=n(""),P=n(""),F=n([]),J=n([]);const Z=s=>{J.value=s},ue=n("");let b=n(),V=n(!1),T=n(!1),w=n(!1),p=qe({name:"",place:"",status:"",pic:"",phone:"",principal:""});Me(()=>{_(),C()});const _=async(s=1)=>{g.value=s;let a=await dl(g.value,S.value,x.value,z.value,U.value,P.value);a.code==200&&(B.value=a.total,j.value=a.data)},de=()=>{_()},ce=()=>{C()},me=()=>{_(),x.value="",z.value="",U.value=""},fe=async s=>{F.value.push(s);const a={ids:F.value};let r=await ie(a);r.code==200?(_(j.value.length>1?g.value:g.value-1),m({type:"success",message:r.message})):m({type:"error",message:r.message})},ge=async()=>{F.value=J.value.map(r=>r.id);const s={ids:F.value};let a=await ie(s);a.code===200?(_(j.value.length>1?g.value:g.value-1),m({type:"success",message:a.message})):m({type:"error",message:a.message})},ve=()=>{R.refresh=!R.refresh},_e=()=>{V.value=!1},ye=s=>{V.value=!0,Object.assign(p,s),Fe(()=>{b.value.clearValidate("name"),b.value.clearValidate("place"),b.value.clearValidate("status"),b.value.clearValidate("pic"),b.value.clearValidate("phone"),b.value.clearValidate("principal")})},he=async()=>{let s=await X(p);s.code==200?(V.value=!1,m({type:"success",message:s.message}),_()):(V.value=!1,m({type:"error",message:s.message}))},be=s=>{p.pic=s.data,b.value.clearValidate("pic")},Ve=s=>{if(s.type==="image/png"||s.type==="image/jpeg"||s.type==="image/gif"){if(s.size/1024/1024<4)return!0;m({type:"error",message:"上传的文件大小应小于4M"})}else return m({type:"error",message:"上传的文件类型必须是PNG|JPG|GIF"}),!1};let we=async s=>{let a={id:s.id,status:s.status},r=await X(a);r.code===200?m({type:"success",message:r.message}):m({type:"error",message:r.message})},Ce=()=>{console.log(E.value),C()},$=n([]),E=n("0"),ke=n("");const C=async(s=1)=>{h.value=s;let a=await rl(h.value,N.value,ke.value,E.value,"1");a.code==200?(O.value=a.total,$.value=a.data,m({type:"success",message:a.message})):m({type:"error",message:a.message})};let ee=()=>{T.value=!0};const q=n("");let i=n(),le=n(!1),Se=s=>{s.status=="0"&&(le.value=!0),q.value="",w.value=!0,i.value=s};const ae=(()=>{const s=new Date,a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),f=String(s.getDate()).padStart(2,"0"),c=String(s.getHours()).padStart(2,"0"),G=String(s.getMinutes()).padStart(2,"0"),H=String(s.getSeconds()).padStart(2,"0");return`${a}-${r}-${f} ${c}:${G}:${H}`})();let te=Re(),xe=async()=>{let s=await pe({id:i.value.id,status:"2",remarks:q.value,approver:te.username,approvalTime:ae});s.code===200?(w.value=!1,C(),m({type:"success",message:s.message})):m({type:"error",message:s.message})},ze=async()=>{if(w.value=!1,(await pe({id:i.value.id,status:"1",remarks:q.value,approver:te.username,approvalTime:ae})).code==200){let a=await il({username:i.value.principalPhone,phone:i.value.principalPhone,nickname:i.value.principalName,status:"1",gender:"0"});a.code==200&&(w.value=!1,C(),_(),await ul({id:a.data,roleId:[3]}),await X({name:i.value.name,principal:i.value.principalName,phone:i.value.principalPhone,place:i.value.address,pic:i.value.pic,userID:a.data,status:"1"}),C(),_())}},Ue=s=>{E.value="0",C(),s()};return(s,a)=>{const r=Ge,f=He,c=Le,G=Je,H=Ke,oe=Ye,u=Qe,Ee=We,Pe=Xe,se=Ze,ne=$e,M=el,re=ll,De=Be("Plus"),Ae=al,Ie=tl,K=ol,D=sl,Ne=nl;return A(),Y(je,null,[e(H,null,{default:t(()=>[e(G,{inline:!0},{default:t(()=>[e(f,{label:"名称:"},{default:t(()=>[e(r,{placeholder:"请输入搜索的用户名",modelValue:o(x),"onUpdate:modelValue":a[0]||(a[0]=l=>v(x)?x.value=l:x=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"地址:"},{default:t(()=>[e(r,{placeholder:"请输入搜索的用户名",modelValue:o(z),"onUpdate:modelValue":a[1]||(a[1]=l=>v(z)?z.value=l:z=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"手机号:"},{default:t(()=>[e(r,{placeholder:"请输入搜索的用户名",modelValue:o(U),"onUpdate:modelValue":a[2]||(a[2]=l=>v(U)?U.value=l:U=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"负责人:"},{default:t(()=>[e(r,{placeholder:"请输入搜索的负责人",modelValue:o(P),"onUpdate:modelValue":a[3]||(a[3]=l=>v(P)?P.value=l:P=l)},null,8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(c,{type:"primary",size:"default",onClick:me,disabled:!(o(x).length||o(z).length||o(U).length||o(P).length)},{default:t(()=>[d(" 搜索 ")]),_:1},8,["disabled"]),e(c,{size:"default",onClick:ve},{default:t(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(c,{type:"danger",size:"default",onClick:ge,disabled:!o(J).length},{default:t(()=>[d(" 批量删除 ")]),_:1},8,["disabled"]),o(O)!=0?(A(),Q(oe,{key:0,value:o(O),max:10,class:"item",style:{"margin-left":"10px"}},{default:t(()=>[e(c,{type:"primary",size:"default",icon:"Edit",onClick:o(ee)},{default:t(()=>[d("查看审核")]),_:1},8,["onClick"])]),_:1},8,["value"])):(A(),Q(c,{key:1,type:"primary",size:"default",icon:"Edit",onClick:o(ee)},{default:t(()=>[d("查看审核")]),_:1},8,["onClick"])),e(se,{border:"",data:o(j),onSelectionChange:Z,style:{"margin-top":"15px"}},{default:t(()=>[e(u,{type:"selection",align:"center",width:"40px"}),e(u,{label:"id",align:"center",prop:"id",width:"50px"}),e(u,{label:"门店图片",align:"center",prop:"pic","show-overflow-tooltip":"",width:"120px"},{default:t(({row:l})=>[I("img",{src:l.pic,alt:"头像",style:{width:"100px",height:"auto"}},null,8,cl)]),_:1}),e(u,{label:"名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(u,{label:"联系方式",align:"center",prop:"phone","show-overflow-tooltip":""}),e(u,{label:"详细地址",align:"center",prop:"place","show-overflow-tooltip":""}),e(u,{label:"状态",align:"center",prop:"status","show-overflow-tooltip":"",width:"60px"},{default:t(({row:l})=>[e(Ee,{modelValue:l.status,"onUpdate:modelValue":k=>l.status=k,class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-value":"1","inactive-value":"0",onChange:k=>o(we)(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{label:"负责人",align:"center",prop:"principal","show-overflow-tooltip":""}),e(u,{label:"操作",width:"300px",align:"center"},{default:t(({row:l})=>[e(c,{type:"primary",size:"small",icon:"Edit",onClick:k=>ye(l)},{default:t(()=>[d(" 编辑 ")]),_:2},1032,["onClick"]),e(Pe,{title:`你确定删除${l.name}`,width:"260px",onConfirm:k=>fe(l.id)},{reference:t(()=>[e(c,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[d(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(ne,{"current-page":o(g),"onUpdate:currentPage":a[4]||(a[4]=l=>v(g)?g.value=l:g=l),"page-size":o(S),"onUpdate:pageSize":a[5]||(a[5]=l=>v(S)?S.value=l:S=l),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper, -> , sizes, total",total:o(B),onCurrentChange:_,onSizeChange:de},null,8,["current-page","page-size","total"])]),_:1}),e(K,{modelValue:o(V),"onUpdate:modelValue":a[11]||(a[11]=l=>v(V)?V.value=l:V=l),title:o(p).id?"更新":"添加"},{footer:t(()=>[I("div",fl,[e(c,{onClick:_e},{default:t(()=>[d("取消")]),_:1}),e(c,{type:"primary",onClick:he},{default:t(()=>[d("确定")]),_:1})])]),default:t(()=>[e(G,{model:o(p),ref_key:"formRef",ref:b},{default:t(()=>[e(f,{label:"名称",prop:"name"},{default:t(()=>[e(r,{placeholder:"请您输入名称",modelValue:o(p).name,"onUpdate:modelValue":a[6]||(a[6]=l=>o(p).name=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"联系方式",prop:"place"},{default:t(()=>[e(r,{placeholder:"请您输入联系方式",modelValue:o(p).place,"onUpdate:modelValue":a[7]||(a[7]=l=>o(p).place=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"详细地址",prop:"phone"},{default:t(()=>[e(r,{placeholder:"请您输入详细地址",modelValue:o(p).phone,"onUpdate:modelValue":a[8]||(a[8]=l=>o(p).phone=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"状态",prop:"status"},{default:t(()=>[e(re,{modelValue:o(p).status,"onUpdate:modelValue":a[9]||(a[9]=l=>o(p).status=l),class:"m-2",placeholder:"请选择状态"},{default:t(()=>[e(M,{label:"暂停营业",value:"0"}),e(M,{label:"正常营业",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"负责人",prop:"principal"},{default:t(()=>[e(r,{placeholder:"请您输入负责人",modelValue:o(p).principal,"onUpdate:modelValue":a[10]||(a[10]=l=>o(p).principal=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"门店图片",prop:"pic"},{default:t(()=>[e(Ie,{class:"avatar-uploader",action:"/api/api/sys/upload","show-file-list":!1,"on-success":be,"before-upload":Ve},{default:t(()=>[o(p).pic?(A(),Y("img",{key:0,src:o(p).pic,class:"avatar"},null,8,ml)):(A(),Q(Ae,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[e(De)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(K,{modelValue:o(T),"onUpdate:modelValue":a[15]||(a[15]=l=>v(T)?T.value=l:T=l),width:"70%","before-close":o(Ue)},{default:t(()=>[e(re,{modelValue:o(E),"onUpdate:modelValue":a[12]||(a[12]=l=>v(E)?E.value=l:E=l),class:"m-2",placeholder:"请选择状态",onChange:o(Ce)},{default:t(()=>[e(M,{label:"待审核",value:"0"}),e(M,{label:"已同意",value:"1"}),e(M,{label:"已拒绝",value:"2"})]),_:1},8,["modelValue","onChange"]),e(se,{border:"",data:o($),onSelectionChange:Z,style:{margin:"15px 0"}},{default:t(()=>[e(u,{label:"id",align:"center",prop:"id",width:"50px"}),e(u,{label:"店铺图片",align:"center",prop:"pic","show-overflow-tooltip":"",width:"120px"},{default:t(({row:l})=>[I("img",{src:l.pic,alt:"店铺图片",style:{width:"100px",height:"auto"}},null,8,gl)]),_:1}),e(u,{label:"名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(u,{label:"负责人",align:"center",prop:"principalName","show-overflow-tooltip":""}),e(u,{label:"联系电话",align:"center",prop:"principalPhone","show-overflow-tooltip":""}),e(u,{label:"地址",align:"center",prop:"address","show-overflow-tooltip":""}),e(u,{label:"操作",width:"300px",align:"center"},{default:t(({row:l})=>[e(c,{type:"primary",size:"small",icon:"Edit",onClick:k=>o(Se)(l)},{default:t(()=>[d(" 查看详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(ne,{"current-page":o(h),"onUpdate:currentPage":a[13]||(a[13]=l=>v(h)?h.value=l:h=l),"page-size":o(N),"onUpdate:pageSize":a[14]||(a[14]=l=>v(N)?N.value=l:N=l),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper, -> , sizes, total",total:o(O),onCurrentChange:C,onSizeChange:ce},null,8,["current-page","page-size","total"])]),_:1},8,["modelValue","before-close"]),e(K,{modelValue:o(w),"onUpdate:modelValue":a[17]||(a[17]=l=>v(w)?w.value=l:w=l),width:"70%",title:"店铺申请详情"},{footer:t(()=>[o(le)?(A(),Y("div",hl,[e(c,{onClick:o(xe)},{default:t(()=>[d("拒绝")]),_:1},8,["onClick"]),e(c,{type:"primary",onClick:o(ze)},{default:t(()=>[d("同意")]),_:1},8,["onClick"])])):Oe("",!0)]),default:t(()=>[e(Ne,{direction:"horizontal",column:1,size:ue.value,border:""},{default:t(()=>[e(D,{label:"图片"},{default:t(()=>[I("img",{src:o(i).pic,alt:"",style:{width:"200px"}},null,8,vl)]),_:1}),e(D,{label:"收货人"},{default:t(()=>[d(W(o(i).principalName),1)]),_:1}),e(D,{label:"联系电话"},{default:t(()=>[d(W(o(i).principalPhone),1)]),_:1}),e(D,{label:"地址"},{default:t(()=>[d(W(o(i).address),1)]),_:1}),e(D,{label:"身份证正反面"},{default:t(()=>{var l,k;return[I("img",{src:(l=o(i))==null?void 0:l.IDCardFront,alt:"",style:{width:"200px"}},null,8,_l),I("img",{src:(k=o(i))==null?void 0:k.IDCardReverse,alt:"",style:{width:"200px"}},null,8,yl)]}),_:1}),e(D,{label:"备注"},{default:t(()=>[e(r,{modelValue:q.value,"onUpdate:modelValue":a[16]||(a[16]=l=>q.value=l),placeholder:"请填写备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["size"])]),_:1},8,["modelValue"])],64)}}});export{Fl as default};
