{"version":3,"file":"cart.js","sources":["../../../../../src/pages/cart/cart.vue","../../../../../uniPage:/cGFnZXMvY2FydC9jYXJ0LnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\nimport { listCart, deleteCart } from '@/services/cart'\nimport { useMemberStore } from '@/stores'\nimport { onShow } from '@dcloudio/uni-app'\nimport { computed, ref } from 'vue'\nimport { useGuessList } from '@/composables'\nimport Guess from '../../components/Guess.vue'\n// 获取会员Store\nconst memberStore = useMemberStore()\n\n// 获取购物车数据\nconst cartList = ref<any>()\n// 优化购物车空列表状态，默认展示列表\nconst showCartList = ref(true)\nconst getMemberCartData = async () => {\n  const res = await listCart({ userID: 103 })\n  if (res.code === 200) {\n    cartList.value = res.data\n    showCartList.value = res.data.length > 0\n  }\n}\n// 初始化调用: 页面显示触发\nonShow(() => {\n  if (memberStore.profile) {\n    getMemberCartData()\n    console.log(cartList.value);\n  }\n})\n// 猜你喜欢\nconst { guessRef, onScrolltolower } = useGuessList()\n// 是否适配底部安全区域\ndefineProps<{\n  safeAreaInsetBottom?: boolean\n}>()\n// 点击删除按钮\nconst onDeleteCart = (id: number) => {\n  console.log(id);\n  // 弹窗二次确认\n  uni.showModal({\n    content: '是否删除',\n    confirmColor: '#27BA9B',\n    success: async (res) => {\n      if (res.confirm) {\n        // 后端删除单品\n        await deleteCart({ ids: [id] })\n        // 重新获取列表\n        getMemberCartData()\n      }\n    },\n  })\n}\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n// 修改商品数量\nconst onChangeCount = (ev: any) => {\n  putMemberCartBySkuIdAPI(ev.index, { count: ev.value })\n}\n\n// 修改选中状态-单品修改\nconst onChangeSelected = (item: any) => {\n  // 前端数据更新-是否选中取反\n  item.selected = !item.selected\n  // 后端数据更新\n  putMemberCartBySkuIdAPI(item.skuId, { selected: item.selected })\n}\n\n// 计算全选状态\nconst isSelectedAll = computed(() => {\n  return cartList.value.length && cartList.value.every((v) => v.selected)\n})\n\n// 修改选中状态-全选修改\nconst onChangeSelectedAll = () => {\n  // 全选状态取反\n  const _isSelectedAll = !isSelectedAll.value\n  // 前端数据更新\n  cartList.value.forEach((item: any) => {\n    item.selected = _isSelectedAll\n  })\n  // 后端数据更新\n  // putMemberCartSelectedAPI({ selected: _isSelectedAll })\n}\n\n// 计算选中单品列表\nconst selectedCartList = computed(() => {\n  return cartList.value.filter((v: any) => v.selected)\n})\n\n// 计算选中总件数\nconst selectedCartListCount = computed(() => {\n  return selectedCartList.value.reduce((sum: any, item: any) => sum + item.count, 0)\n})\n\n// 计算选中总金额\nconst selectedCartListMoney = computed(() => {\n  return selectedCartList.value\n    .reduce((sum: any, item: any) => sum + item.count * item.listSkuData.price, 0)\n    .toFixed(2)\n})\n\n// 结算按钮\nconst gotoPayment = () => {\n  let sku: any = []\n  if (selectedCartListCount.value === 0) {\n    return uni.showToast({\n      icon: 'none',\n      title: '请选择商品',\n    })\n  }\n  let dd = cartList.value.filter((v: any) => v.selected)\n  for (let index = 0; index < dd.length; index++) {\n    sku.push(\n      {\n        id: dd[index].id,\n        count: dd[index].count,\n        skuID: dd[index].skuID,\n        name: dd[index].listSkuData.name,\n        pic: dd[index].listSkuData.pic.replace(/\"/g, ''),\n        price: dd[index].listSkuData.price,\n        tag: dd[index].listSkuData.tag,\n        productId: dd[index].listSkuData.productId,\n      }\n    )\n  }\n  // console.log(skuIDs);\n  // 跳转到结算页\n  uni.navigateTo({\n    url: '/pages/orderCreate/index?sku=' + encodeURIComponent(JSON.stringify(sku)),\n  })\n}\n\n</script>\n\n<template>\n  <scroll-view enable-back-to-top scroll-y class=\"scroll-view\" @scrolltolower=\"onScrolltolower\">\n    <!-- 已登录: 显示购物车 -->\n    <template v-if=\"memberStore.profile\">\n      <!-- 购物车列表 -->\n      <view class=\"cart-list\" v-if=\"cartList\">\n        <!-- 优惠提示 -->\n        <view class=\"tips\">\n          <text class=\"label\">满减</text>\n          <text class=\"desc\">满1件, 即可享受包邮免费送</text>\n        </view>\n        <!-- 滑动操作分区 -->\n        <uni-swipe-action>\n          <!-- 滑动操作项 -->\n          <uni-swipe-action-item v-for=\"item in cartList\" :key=\"item.skuId\" class=\"cart-swipe\">\n            <!-- 商品信息 -->\n            <view class=\"goods\">\n              <!--  -->\n              <!-- 选中状态 -->\n              <text @tap=\"onChangeSelected(item)\" class=\"checkbox\" :class=\"{ checked: item.selected }\"></text>\n              <view class=\"navigator\">\n                <navigator class=\"dianpu\">\n                  <text class=\"label\">店铺</text>\n                  <text class=\"name\">{{ item?.merchantData.name }}</text>\n                </navigator>\n                <navigator :url=\"`/pages/goods/index?id=${item.listSkuData.productId}`\" hover-class=\"none\"\n                  class=\"navigator1\">\n                  <image mode=\"aspectFill\" class=\"picture\" :src=\"item?.listSkuData.pic\"></image>\n                  <view class=\"meta\">\n                    <view class=\"name ellipsis\">{{ item?.listSkuData.name }}</view>\n                    <view class=\"attrsText ellipsis\">{{ item?.listSkuData.tag }}</view>\n                    <view class=\"price\">{{ item?.listSkuData.price }}</view>\n                  </view>\n                </navigator>\n              </view>\n\n              <!-- 商品数量 -->\n              <view class=\"count\">\n                <vk-data-input-number-box v-model=\"item.count\" :min=\"1\" :max=\"item.stock\" :index=\"item.skuId\"\n                  @change=\"onChangeCount\" />\n              </view>\n            </view>\n            <!-- 右侧删除按钮 -->\n            <template #right>\n              <view class=\"cart-swipe-right\">\n                <button @tap=\"onDeleteCart(item.id)\" class=\"button delete-button\">删除</button>\n              </view>\n            </template>\n          </uni-swipe-action-item>\n        </uni-swipe-action>\n      </view>\n      <!-- 购物车空状态 -->\n      <view class=\"cart-blank\" v-else>\n        <image src=\"/static/images/cart.png\" class=\"image\" />\n        <text class=\"text\">购物车还是空的，快来挑选好货吧</text>\n      </view>\n      <!-- 吸底工具栏 -->\n      <view v-if=\"cartList\" class=\"toolbar\"\n        :style=\"{ paddingBottom: safeAreaInsetBottom ? safeAreaInsets?.bottom + 'px' : 0 }\">\n        <text @tap=\"onChangeSelectedAll\" class=\"all\" :class=\"{ checked: isSelectedAll }\">全选</text>\n        <text class=\"text\">合计:</text>\n        <text class=\"amount\">{{ selectedCartListMoney }}</text>\n        <view class=\"button-grounp\">\n          <view @tap=\"gotoPayment\" class=\"button payment-button\" :class=\"{ disabled: selectedCartListCount === 0 }\">\n            去结算({{ selectedCartListCount }})\n          </view>\n        </view>\n      </view>\n    </template>\n    <!-- 未登录: 提示登录 -->\n    <view class=\"login-blank\" v-else>\n      <text class=\"text\">登录后可查看购物车中的商品</text>\n      <navigator url=\"/pages/login/login\" hover-class=\"none\">\n        <button class=\"button\">去登录</button>\n      </navigator>\n    </view>\n    <!-- 猜你喜欢 -->\n    <Guess ref=\"guessRef\" />\n    <!-- 底部占位空盒子 -->\n    <view class=\"toolbar-height\"></view>\n  </scroll-view>\n</template>\n\n<style lang=\"scss\">\n// 根元素\n:host {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background-color: #f7f7f8;\n}\n\n// 滚动容器\n.scroll-view {\n  flex: 1;\n}\n\n// 购物车列表\n.cart-list {\n  padding: 0 20rpx;\n\n  // 优惠提示\n  .tips {\n    display: flex;\n    align-items: center;\n    line-height: 1;\n    margin: 30rpx 10rpx;\n    font-size: 26rpx;\n    color: #666;\n\n    .label {\n      color: #fff;\n      padding: 7rpx 15rpx 5rpx;\n      border-radius: 4rpx;\n      font-size: 24rpx;\n      background-color: #27ba9b;\n      margin-right: 10rpx;\n    }\n  }\n\n  // 购物车商品\n  .goods {\n    display: flex;\n    padding: 20rpx 20rpx 20rpx 80rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n    position: relative;\n\n    .dianpu {\n      margin-bottom: 10rpx;\n\n      .name {\n        height: 72rpx;\n        font-size: 28rpx;\n        color: #444;\n      }\n\n      .label {\n        color: #fff;\n        padding: 7rpx 15rpx 5rpx;\n        border-radius: 4rpx;\n        font-size: 24rpx;\n        background-color: #dc9c4f;\n        margin-right: 10rpx;\n      }\n    }\n\n    .navigator1 {\n      display: flex;\n    }\n\n    .checkbox {\n      position: absolute;\n      top: 0;\n      left: 0;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 80rpx;\n      height: 100%;\n\n      &::before {\n        content: '\\e6cd';\n        font-family: 'erabbit' !important;\n        font-size: 40rpx;\n        color: #444;\n      }\n\n      &.checked::before {\n        content: '\\e6cc';\n        color: #27ba9b;\n      }\n    }\n\n    .picture {\n      width: 170rpx;\n      height: 170rpx;\n    }\n\n    .meta {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      margin-left: 20rpx;\n    }\n\n    .name {\n      height: 72rpx;\n      font-size: 26rpx;\n      color: #444;\n    }\n\n    .attrsText {\n      line-height: 1.8;\n      padding: 0 15rpx;\n      font-size: 24rpx;\n      align-self: flex-start;\n      border-radius: 4rpx;\n      color: #888;\n      background-color: #f7f7f8;\n    }\n\n    .price {\n      line-height: 1;\n      font-size: 26rpx;\n      color: #444;\n      margin-bottom: 2rpx;\n      color: #cf4444;\n\n      &::before {\n        content: '￥';\n        font-size: 80%;\n      }\n    }\n\n    // 商品数量\n    .count {\n      position: absolute;\n      bottom: 20rpx;\n      right: 5rpx;\n\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      width: 220rpx;\n      height: 48rpx;\n\n      .text {\n        height: 100%;\n        padding: 0 20rpx;\n        font-size: 32rpx;\n        color: #444;\n      }\n\n      .input {\n        height: 100%;\n        text-align: center;\n        border-radius: 4rpx;\n        font-size: 24rpx;\n        color: #444;\n        background-color: #f6f6f6;\n      }\n    }\n  }\n\n  .cart-swipe {\n    display: block;\n    margin: 20rpx 0;\n  }\n\n  .cart-swipe-right {\n    display: flex;\n    height: 100%;\n\n    .button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 50px;\n      padding: 6px;\n      line-height: 1.5;\n      color: #fff;\n      font-size: 26rpx;\n      border-radius: 0;\n    }\n\n    .delete-button {\n      background-color: #cf4444;\n    }\n  }\n}\n\n// 空状态\n.cart-blank,\n.login-blank {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  height: 60vh;\n\n  .image {\n    width: 400rpx;\n    height: 281rpx;\n  }\n\n  .text {\n    color: #444;\n    font-size: 26rpx;\n    margin: 20rpx 0;\n  }\n\n  .button {\n    width: 240rpx !important;\n    height: 60rpx;\n    line-height: 60rpx;\n    margin-top: 20rpx;\n    font-size: 26rpx;\n    border-radius: 60rpx;\n    color: #fff;\n    background-color: #27ba9b;\n  }\n}\n\n// 吸底工具栏\n.toolbar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: var(--window-bottom);\n  z-index: 1;\n\n  height: 100rpx;\n  padding: 0 20rpx;\n  display: flex;\n  align-items: center;\n  border-top: 1rpx solid #ededed;\n  border-bottom: 1rpx solid #ededed;\n  background-color: #fff;\n  box-sizing: content-box;\n\n  .all {\n    margin-left: 25rpx;\n    font-size: 14px;\n    color: #444;\n    display: flex;\n    align-items: center;\n  }\n\n  .all::before {\n    font-family: 'erabbit' !important;\n    content: '\\e6cd';\n    font-size: 40rpx;\n    margin-right: 8rpx;\n  }\n\n  .checked::before {\n    content: '\\e6cc';\n    color: #27ba9b;\n  }\n\n  .text {\n    margin-right: 8rpx;\n    margin-left: 32rpx;\n    color: #444;\n    font-size: 14px;\n  }\n\n  .amount {\n    font-size: 20px;\n    color: #cf4444;\n\n    .decimal {\n      font-size: 12px;\n    }\n\n    &::before {\n      content: '￥';\n      font-size: 12px;\n    }\n  }\n\n  .button-grounp {\n    margin-left: auto;\n    display: flex;\n    justify-content: space-between;\n    text-align: center;\n    line-height: 72rpx;\n    font-size: 13px;\n    color: #fff;\n\n    .button {\n      width: 240rpx;\n      margin: 0 10rpx;\n      border-radius: 72rpx;\n    }\n\n    .payment-button {\n      background-color: #27ba9b;\n\n      &.disabled {\n        opacity: 0.6;\n      }\n    }\n  }\n}\n\n// 底部占位空盒子\n.toolbar-height {\n  height: 100rpx;\n}\n</style>","import MiniProgramPage from '/Users/gygy/Desktop/毕业设计/SimplePick-Mall-UniUI/src/pages/cart/cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["useMemberStore","ref","listCart","onShow","useGuessList","uni","deleteCart","computed"],"mappings":"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"}