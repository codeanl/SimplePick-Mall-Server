{"version":3,"file":"index.js","sources":["../../../../../src/pages/orderList/index.vue","../../../../../uniPage:/cGFnZXMvb3JkZXJMaXN0L2luZGV4LnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { useMemberStore } from '@/stores'\nimport { orderStateList } from '@/services/constants'\n// 获取会员Store\nconst memberStore = useMemberStore()\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n// tabs 数据\nconst orderTabs = ref([\n  { orderState: 100, title: '全部', isRender: false },\n  { orderState: 0, title: '待付款', isRender: false },\n  { orderState: 1, title: '待发货', isRender: false },\n  { orderState: 2, title: '运输中', isRender: false },\n  { orderState: 3, title: '待提货', isRender: false },\n])\n\n// 高亮下标\nconst activeIndex = ref(orderTabs.value.findIndex((v) => v.orderState === parseInt(query.status)))\n// 默认渲染容器\norderTabs.value[activeIndex.value].isRender = true\nconst query = defineProps<{\n  status: string\n}>()\n\nimport { listOrder } from '@/services/order'\nonLoad(() => {\n  getData(query.status)\n})\nconst order = ref<any>()\nconst getData = async (status: number) => {\n  order.value = []\n  if (status < 100) {\n    const res = await listOrder({ status: status, userID: memberStore.profile.info.id })\n    if (res.code === 200) {\n      order.value = res.data\n    }\n  } else {\n    const res = await listOrder({ userID: memberStore.profile.info.id })\n    if (res.code === 200) {\n      order.value = res.data\n    }\n  }\n}\n\nlet now = ref()\nlet handleTabClick = (index: any, id: any) => {\n  console.log(index, id)\n  now.value = id\n  activeIndex.value = index\n  orderTabs.value.forEach((item, i) => {\n    item.isRender = i === index\n  })\n  getData(id.toString())\n}\nlet getCurrentDateTime = () => {\n  const now = new Date()\n  const year = now.getFullYear()\n  const month = String(now.getMonth() + 1).padStart(2, '0') // 月份从 0 开始，需要加 1，并补零\n  const day = String(now.getDate()).padStart(2, '0') // 补零\n  const hours = String(now.getHours()).padStart(2, '0') // 补零\n  const minutes = String(now.getMinutes()).padStart(2, '0') // 补零\n  const seconds = String(now.getSeconds()).padStart(2, '0') // 补零\n  const dateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\n  return dateTime\n}\n\nimport { orderInfo, updateOrder } from '@/services/order'\n// 订单支付\nconst onOrderPay = async (id: number) => {\n  const currentDateTime = getCurrentDateTime()\n  let res = await updateOrder({\n    id: id,\n    status: '1',\n    paymentTime: currentDateTime,\n  })\n  if (res.code == 200) {\n    // 关闭当前页，再跳转支付结果页\n    uni.redirectTo({ url: `/pages/payment/index?id=${id}` })\n  }\n}\n// 模拟发货\nconst onDeliver = async (id: number) => {\n  let res = await updateOrder({\n    id: id,\n    status: '3',\n  })\n  if (res.code == 200) {\n    uni.showToast({ icon: 'success', title: '模拟发货完成' })\n  }\n}\n\nconst onCancel = async (id: number) => {\n  console.log(now.value)\n  let res = await updateOrder({\n    id: id,\n    status: '5',\n  })\n  if (res.code == 200) {\n    getData(now.value.toString())\n    uni.showToast({ icon: 'success', title: '取消订单完成' })\n  }\n}\nconst onConfirm = async (id: number) => {\n  const currentDateTime = getCurrentDateTime()\n  // 二次确认弹窗\n  uni.showModal({\n    content: '为保障您的权益，请收到货并确认无误后，再确认收货',\n    confirmColor: '#27BA9B',\n    success: async (success) => {\n      if (success.confirm) {\n        let res = await updateOrder({\n          id: id,\n          status: '4',\n          receiveTime: currentDateTime,\n        })\n        if (res.code == 200) {\n          getData(now.value.toString())\n          uni.showToast({ icon: 'success', title: '确认收货完成' })\n        }\n      }\n    },\n  })\n}\nconst onComment = async (id: number) => {\n  const currentDateTime = getCurrentDateTime()\n  let res = await updateOrder({\n    id: id,\n    status: '4',\n    commentTime: currentDateTime,\n  })\n  if (res.code == 200) {\n    uni.showToast({ icon: 'success', title: '评论完成' })\n  }\n}\nconst isTriggered = ref(false)\nconst onRefresherrefresh = async () => {\n  isTriggered.value = true\n\n  // isTriggered.value = false\n}\n\nconst createOrder = () => {\n  console.log('111')\n}\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- tabs -->\n    <view class=\"tabs\">\n      <text\n        class=\"item\"\n        v-for=\"(item, index) in orderTabs\"\n        :key=\"item.title\"\n        @tap=\"handleTabClick(index, item.orderState)\"\n      >\n        {{ item.title }}\n      </text>\n      <!-- 游标 -->\n      <view class=\"cursor\" :style=\"{ left: activeIndex * 20 + '%' }\"></view>\n    </view>\n    <!-- 滑动容器 -->\n    <swiper class=\"swiper\" :current=\"activeIndex\" @change=\"activeIndex = $event.detail.current\">\n      <!-- 滑动项 -->\n      <swiper-item v-for=\"item in orderTabs\" :key=\"item.title\">\n        <!-- 订单列表 -->\n        <scroll-view scroll-y class=\"orders\" @refresherrefresh=\"onRefresherrefresh\">\n          <view class=\"card\" v-for=\"item in order\" :key=\"item\">\n            <!-- 订单信息 -->\n            <view class=\"status\">\n              <navigator class=\"dianpu\" url=\"/pages/login/index\">\n                <text class=\"label\">店铺</text>\n                <text class=\"name\">{{ item?.merchantInfo.name }} ></text>\n              </navigator>\n              <!-- <text class=\"date\">{{ item.createTime }}</text> -->\n              <!-- 订单状态文字 -->\n              <!-- 待评价/已完成/已取消 状态: 展示删除订单 -->\n              <text class=\"statusText\">{{ orderStateList[item.status].text }}</text>\n              <text class=\"icon-delete\"></text>\n            </view>\n            <!-- 商品信息，点击商品跳转到订单详情，不是商品详情 -->\n            <navigator\n              v-for=\"sku in item.skuList\"\n              :key=\"sku.id\"\n              class=\"goods\"\n              :url=\"`/pages/detail/index?id=${item.id}`\"\n              hover-class=\"none\"\n            >\n              <view class=\"cover\">\n                <image class=\"image\" mode=\"aspectFit\" :src=\"sku.pic\"></image>\n              </view>\n              <view class=\"meta\">\n                <view class=\"name ellipsis\">{{ sku.productName }}</view>\n                <view class=\"type\">{{ sku.tag }}</view>\n              </view>\n            </navigator>\n            <!-- 支付信息 -->\n            <view class=\"payment\">\n              <text class=\"quantity\">共1件商品</text>\n              <text>实付</text>\n              <text class=\"amount\"> <text class=\"symbol\">¥</text>{{ item.payAmount }}</text>\n            </view>\n            <!-- 订单操作按钮 -->\n            <view class=\"action\">\n              <!-- 待付款状态：显示去支付按钮 -->\n              <template v-if=\"item.status == '0'\">\n                <view class=\"button\" @tap=\"onCancel(item.id)\">取消订单</view>\n                <view class=\"button primary\" @tap=\"onOrderPay(item.id)\">去支付</view>\n              </template>\n              <template v-if=\"item.status == '1'\">\n                <navigator\n                  class=\"button secondary\"\n                  :url=\"`/pages/orderCreate/index?sku=${encodeURIComponent(\n                    JSON.stringify(item.skuList),\n                  )}`\"\n                  hover-class=\"none\"\n                >\n                  再次购买\n                </navigator>\n              </template>\n              <template v-if=\"item.status == '2'\">\n                <navigator\n                  class=\"button secondary\"\n                  :url=\"`/pages/orderCreate/index?sku=${encodeURIComponent(\n                    JSON.stringify(item.skuList),\n                  )}`\"\n                  hover-class=\"none\"\n                >\n                  再次购买\n                </navigator>\n              </template>\n              <template v-if=\"item.status == '3'\">\n                <view class=\"button primary\" @tap=\"onConfirm(item.id)\">确认收货</view>\n              </template>\n            </view>\n          </view>\n          <!-- 底部提示文字 -->\n          <view class=\"loading-text\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n            {{ true ? '没有更多数据~' : '正在加载...' }}\n          </view>\n        </scroll-view>\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n  overflow: hidden;\n}\n\n.viewport {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background-color: #fff;\n}\n\n// tabs\n.tabs {\n  display: flex;\n  justify-content: space-around;\n  line-height: 60rpx;\n  margin: 0 10rpx;\n  background-color: #fff;\n  box-shadow: 0 4rpx 6rpx rgba(240, 240, 240, 0.6);\n  position: relative;\n  z-index: 9;\n\n  .item {\n    flex: 1;\n    text-align: center;\n    padding: 20rpx;\n    font-size: 28rpx;\n    color: #262626;\n  }\n\n  .cursor {\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    width: 20%;\n    height: 6rpx;\n    padding: 0 50rpx;\n    background-color: #27ba9b;\n    /* 过渡效果 */\n    transition: all 0.4s;\n  }\n}\n\n// swiper\n.swiper {\n  background-color: #f7f7f8;\n}\n\n// 订单列表\n.orders {\n  .card {\n    min-height: 100rpx;\n    padding: 20rpx;\n    margin: 20rpx 20rpx 0;\n    border-radius: 10rpx;\n    background-color: #fff;\n\n    &:last-child {\n      padding-bottom: 40rpx;\n    }\n  }\n\n  .status {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    font-size: 28rpx;\n    color: #999;\n    margin-bottom: 15rpx;\n\n    .dianpu {\n      margin-bottom: 10rpx;\n\n      .name {\n        height: 72rpx;\n        font-size: 28rpx;\n        color: #444;\n      }\n\n      .label {\n        color: #fff;\n        padding: 7rpx 15rpx 5rpx;\n        border-radius: 4rpx;\n        font-size: 24rpx;\n        background-color: #dc9c4f;\n        margin-right: 10rpx;\n      }\n    }\n\n    .date {\n      color: #666;\n      flex: 1;\n    }\n\n    .primary {\n      color: #ff9240;\n    }\n\n    .statusText {\n      margin-left: 60rpx;\n    }\n\n    .icon-delete {\n      line-height: 1;\n      margin-left: 10rpx;\n      padding-left: 10rpx;\n      border-left: 1rpx solid #e3e3e3;\n    }\n  }\n\n  .goods {\n    display: flex;\n    margin-bottom: 20rpx;\n\n    .cover {\n      width: 170rpx;\n      height: 170rpx;\n      margin-right: 20rpx;\n      border-radius: 10rpx;\n      overflow: hidden;\n      position: relative;\n    }\n\n    .quantity {\n      position: absolute;\n      bottom: 0;\n      right: 0;\n      line-height: 1;\n      padding: 6rpx 4rpx 6rpx 8rpx;\n      font-size: 24rpx;\n      color: #fff;\n      border-radius: 10rpx 0 0 0;\n      background-color: rgba(0, 0, 0, 0.6);\n    }\n\n    .meta {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n    }\n\n    .name {\n      height: 80rpx;\n      font-size: 26rpx;\n      color: #444;\n    }\n\n    .type {\n      line-height: 1.8;\n      padding: 0 15rpx;\n      margin-top: 10rpx;\n      font-size: 24rpx;\n      align-self: flex-start;\n      border-radius: 4rpx;\n      color: #888;\n      background-color: #f7f7f8;\n    }\n\n    .more {\n      flex: 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 22rpx;\n      color: #333;\n    }\n  }\n\n  .payment {\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    line-height: 1;\n    padding: 20rpx 0;\n    text-align: right;\n    color: #999;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #eee;\n\n    .quantity {\n      font-size: 24rpx;\n      margin-right: 16rpx;\n    }\n\n    .amount {\n      color: #444;\n      margin-left: 6rpx;\n    }\n\n    .symbol {\n      font-size: 20rpx;\n    }\n  }\n\n  .action {\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-top: 20rpx;\n\n    .button {\n      width: 180rpx;\n      height: 60rpx;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      margin-left: 20rpx;\n      border-radius: 60rpx;\n      border: 1rpx solid #ccc;\n      font-size: 26rpx;\n      color: #444;\n    }\n\n    .secondary {\n      color: #27ba9b;\n      border-color: #27ba9b;\n    }\n\n    .primary {\n      color: #fff;\n      background-color: #27ba9b;\n    }\n  }\n\n  .loading-text {\n    text-align: center;\n    font-size: 28rpx;\n    color: #666;\n    padding: 20rpx 0;\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/gygy/Desktop/毕业设计/SimplePick-Mall-UniUI/src/pages/orderList/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useMemberStore","uni","ref","onLoad","listOrder","now","updateOrder"],"mappings":"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"}