{"version":3,"file":"index.js","sources":["../../../../../src/pages/profile/index.vue","../../../../../uniPage:/cGFnZXMvcHJvZmlsZS9pbmRleC52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport { getMemberProfileAPI, putMemberProfileAPI } from '../../services/profile'\nimport { useMemberStore } from '@/stores'\n// import { formatDate } from '@/utils'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { ref } from 'vue'\n\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\n// 获取个人信息，修改个人信息需提供初始值\nconst profile = ref()\nconst getMemberProfileData = async () => {\n  const requestData = { id: memberStore.profile.info.id }\n  const res = await getMemberProfileAPI(requestData)\n  profile.value = res.data\n  // 同步 Store 的头像和昵称，用于我的页面展示\n  memberStore.profile!.info.avatar = res.data.avatar\n  memberStore.profile!.info.nickname = res.data.nickname\n}\n\nonLoad(() => {\n  getMemberProfileData()\n})\n\nconst memberStore = useMemberStore()\n// 修改头像\nconst onAvatarChange = () => {\n  // 调用拍照/选择图片\n  // 选择图片条件编译\n\n\n\n\n\n\n\n\n\n\n\n\n\n  // uni.chooseMedia 仅支持微信小程序端\n  uni.chooseMedia({\n    // 文件个数\n    count: 1,\n    // 文件类型\n    mediaType: ['image'],\n    success: (res) => {\n      // 本地路径\n      const { tempFilePath } = res.tempFiles[0]\n      // 上传\n      uploadFile(tempFilePath)\n    },\n  })\n\n}\n// 文件上传-兼容小程序端、H5端、App端\nconst uploadFile = (file: string) => {\n  uni.uploadFile({\n    url: '/api/upload',\n    name: 'file',\n    filePath: file,\n    success: (res: any) => {\n      updateAvatar(JSON.parse(res.data))\n    },\n  })\n}\nlet updateAvatar = async (data: any) => {\n  console.log(data.data)\n  memberStore.profile!.info.avatar = data.data\n  let res = await putMemberProfileAPI({\n    id: memberStore.profile.info.id,\n    avatar: data.data,\n  })\n  if (res.code == 200) {\n    uni.showToast({ icon: 'success', title: '更新成功' })\n    profile.value.avatar = data.data\n  } else {\n    uni.showToast({ icon: 'error', title: '出现错误' })\n  }\n}\n\n// 修改性别\nconst onGenderChange: UniHelper.RadioGroupOnChange = (ev) => {\n  profile.value.gender = ev.detail.value\n}\n\n// 点击保存提交表单\nconst onSubmit = async () => {\n  const { nickname, gender, email, signature } = profile.value\n  const res = await putMemberProfileAPI({\n    id: memberStore.profile.info.id,\n    nickname,\n    gender,\n    email,\n    signature,\n  })\n  if (res.code == 200) {\n    uni.showToast({ icon: 'success', title: '保存成功' })\n    setTimeout(() => {\n      uni.navigateBack()\n    }, 400)\n    // 更新Store昵称\n    memberStore.profile!.nickname = res.data.nickname\n    memberStore.profile!.email = res.data.email\n    memberStore.profile!.gender = res.data.gender\n    memberStore.profile!.signature = res.data.signature\n  }\n}\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n      <navigator open-type=\"navigateBack\" class=\"back icon-left\" hover-class=\"none\"></navigator>\n      <view class=\"title\">个人信息</view>\n    </view>\n    <!-- 头像 -->\n    <view class=\"avatar\">\n      <view @tap=\"onAvatarChange\" class=\"avatar-content\">\n        <image class=\"image\" :src=\"profile?.avatar\" mode=\"aspectFill\" />\n        <text class=\"text\">点击修改头像</text>\n      </view>\n    </view>\n    <!-- 表单 -->\n    <view class=\"form\">\n      <!-- 表单内容 -->\n      <view class=\"form-content\">\n        <view class=\"form-item\">\n          <text class=\"label\">账号</text>\n          <text class=\"account placeholder\">{{ profile?.username }}</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写昵称\" v-model=\"profile!.nickname\" />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">邮箱</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写邮箱\" v-model=\"profile!.email\" />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">性别</text>\n          <radio-group @change=\"onGenderChange\">\n            <label class=\"radio\">\n              <radio value=\"0\" color=\"#27ba9b\" :checked=\"profile?.gender === '0'\" />\n              未知\n            </label>\n            <label class=\"radio\">\n              <radio value=\"1\" color=\"#27ba9b\" :checked=\"profile?.gender === '1'\" />\n              男\n            </label>\n            <label class=\"radio\">\n              <radio value=\"2\" color=\"#27ba9b\" :checked=\"profile?.gender === '2'\" />\n              女\n            </label>\n          </radio-group>\n        </view>\n\n\n\n        <view class=\"form-item\">\n          <text class=\"label\">个性签名</text>\n          <input\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请填写个性签名\"\n            v-model=\"profile!.signature\"\n          />\n        </view>\n      </view>\n      <!-- 提交按钮 -->\n      <button @tap=\"onSubmit\" class=\"form-button\">保 存</button>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background-color: #fe9333;\n  //background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n  background-size: auto 420rpx;\n  background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n  position: relative;\n\n  .title {\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 16px;\n    font-weight: 500;\n    color: #fff;\n  }\n\n  .back {\n    position: absolute;\n    height: 40px;\n    width: 40px;\n    left: 0;\n    font-size: 20px;\n    color: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n// 头像\n.avatar {\n  text-align: center;\n  width: 100%;\n  height: 260rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  .image {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 50%;\n    background-color: #eee;\n  }\n\n  .text {\n    display: block;\n    padding-top: 20rpx;\n    line-height: 1;\n    font-size: 26rpx;\n    color: #fff;\n  }\n}\n\n// 表单\n.form {\n  background-color: #f4f4f4;\n\n  &-content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n\n  &-item {\n    display: flex;\n    height: 96rpx;\n    line-height: 46rpx;\n    padding: 25rpx 10rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 180rpx;\n      color: #333;\n    }\n\n    .account {\n      color: #666;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .radio {\n      margin-right: 20rpx;\n    }\n\n    .picker {\n      flex: 1;\n    }\n\n    .placeholder {\n      color: #808080;\n    }\n  }\n\n  &-button {\n    height: 80rpx;\n    text-align: center;\n    line-height: 80rpx;\n    margin: 30rpx 20rpx;\n    color: #fff;\n    border-radius: 80rpx;\n    font-size: 30rpx;\n    background-color: #27ba9b;\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/gygy/Desktop/毕业设计/SimplePick-Mall-UniUI/src/pages/profile/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","onLoad","useMemberStore","putMemberProfileAPI"],"mappings":";;;;;;;;;AAQA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAGjD,UAAM,UAAUC,cAAAA;AAChB,UAAM,uBAAuB,YAAY;AACvC,YAAM,cAAc,EAAE,IAAI,YAAY,QAAQ,KAAK;AAC7C,YAAA,MAAM,MAAMC,qCAAoB,WAAW;AACjD,cAAQ,QAAQ,IAAI;AAEpB,kBAAY,QAAS,KAAK,SAAS,IAAI,KAAK;AAC5C,kBAAY,QAAS,KAAK,WAAW,IAAI,KAAK;AAAA,IAAA;AAGhDC,kBAAAA,OAAO,MAAM;AACU;IAAA,CACtB;AAED,UAAM,cAAcC,sBAAAA;AAEpB,UAAM,iBAAiB,MAAM;AAiB3BJ,oBAAAA,MAAI,YAAY;AAAA;AAAA,QAEd,OAAO;AAAA;AAAA,QAEP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAS,CAAC,QAAQ;AAEhB,gBAAM,EAAE,aAAiB,IAAA,IAAI,UAAU,CAAC;AAExC,qBAAW,YAAY;AAAA,QACzB;AAAA,MAAA,CACD;AAAA,IAAA;AAIG,UAAA,aAAa,CAAC,SAAiB;AACnCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,QACL,MAAM;AAAA,QACN,UAAU;AAAA,QACV,SAAS,CAAC,QAAa;AACrB,uBAAa,KAAK,MAAM,IAAI,IAAI,CAAC;AAAA,QACnC;AAAA,MAAA,CACD;AAAA,IAAA;AAEC,QAAA,eAAe,OAAO,SAAc;AAC9B,cAAA,IAAI,KAAK,IAAI;AACT,kBAAA,QAAS,KAAK,SAAS,KAAK;AACpC,UAAA,MAAM,MAAMK,qCAAoB;AAAA,QAClC,IAAI,YAAY,QAAQ,KAAK;AAAA,QAC7B,QAAQ,KAAK;AAAA,MAAA,CACd;AACG,UAAA,IAAI,QAAQ,KAAK;AACnBL,sBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AACxC,gBAAA,MAAM,SAAS,KAAK;AAAA,MAAA,OACvB;AACLA,sBAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,QAAQ;AAAA,MAChD;AAAA,IAAA;AAII,UAAA,iBAA+C,CAAC,OAAO;AACnD,cAAA,MAAM,SAAS,GAAG,OAAO;AAAA,IAAA;AAInC,UAAM,WAAW,YAAY;AAC3B,YAAM,EAAE,UAAU,QAAQ,OAAO,cAAc,QAAQ;AACjD,YAAA,MAAM,MAAMK,qCAAoB;AAAA,QACpC,IAAI,YAAY,QAAQ,KAAK;AAAA,QAC7B;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AACG,UAAA,IAAI,QAAQ,KAAK;AACnBL,sBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAChD,mBAAW,MAAM;AACfA,wBAAA,MAAI,aAAa;AAAA,WAChB,GAAG;AAEM,oBAAA,QAAS,WAAW,IAAI,KAAK;AAC7B,oBAAA,QAAS,QAAQ,IAAI,KAAK;AAC1B,oBAAA,QAAS,SAAS,IAAI,KAAK;AAC3B,oBAAA,QAAS,YAAY,IAAI,KAAK;AAAA,MAC5C;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;AC5GF,GAAG,WAAW,eAAe;"}