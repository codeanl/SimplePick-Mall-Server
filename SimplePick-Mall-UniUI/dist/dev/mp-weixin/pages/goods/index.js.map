{"version":3,"file":"index.js","sources":["../../../../../src/pages/goods/index.vue","../../../../../uniPage:/cGFnZXMvZ29vZHMvaW5kZXgudnVl"],"sourcesContent":["// src/pages/goods/goods.vue\n<script setup lang=\"ts\">\nimport type {\n  SkuPopupEvent,\n  SkuPopupInstance,\n  SkuPopupLocaldata,\n} from '@/components/vk-data-goods-sku-popup/vk-data-goods-sku-popup'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\nimport { onLoad } from '@dcloudio/uni-app'\nimport { computed, ref } from 'vue'\nimport { getProductInfoAPI } from '@/services/home'\nimport { addCart } from '@/services/cart'\nimport AddressPanel from './components/AddressPanel.vue'\nimport ServicePanel from './components/ServicePanel.vue'\n// 接收页面参数\nconst query = defineProps<{\n  id: number\n}>()\n\n// 获取商品详情信息\nconst goods = ref<any>()\nconst getGoodsByIdData = async () => {\n  let id = Number(query.id)\n  const res = await getProductInfoAPI({ id: id })\n  goods.value = res.data\n  // SKU组件所需格式\n  localdata.value = {\n    _id: res.data.productInfo.id,\n    name: res.data.productInfo.name,\n    goods_thumb: res.data.productInfo.pic,\n    spec_list: res.data.sizeList.map((v) => {\n      return {\n        name: v.name,\n        list: v.values,\n      }\n    }),\n    sku_list: res.data.skuList.map((v) => {\n      return {\n        _id: v.id,\n        goods_id: v.productId,\n        goods_name: v.name,\n        image: v.pic,\n        price: v.price * 100, // 注意：需要乘以 100\n        stock: v.stock,\n        sku_name_arr: v.specs.map((vv) => vv.valueName),\n      }\n    }),\n  }\n}\n\n// 页面加载\nonLoad(() => {\n  getGoodsByIdData()\n})\n\n// 轮播图变化时\nconst currentIndex = ref(0)\nconst onChange: UniHelper.SwiperOnChange = (ev) => {\n  currentIndex.value = ev.detail.current\n}\n\n// 点击图片时\nconst onTapImage = (url: string) => {\n  // 大图预览\n  uni.previewImage({\n    current: url,\n    urls: goods.value!.imgUrl,\n  })\n}\n\n// uni-ui 弹出层组件 ref\nconst popup = ref<{\n  open: (type?: UniHelper.UniPopupType) => void\n  close: () => void\n}>()\n\n// 弹出层条件渲染\nconst popupName = ref<'address' | 'service'>()\nconst openPopup = (name: typeof popupName.value) => {\n  // 修改弹出层名称\n  popupName.value = name\n  popup.value?.open()\n}\n// 是否显示SKU组件\nconst isShowSku = ref(false)\n// 商品信息\nconst localdata = ref({} as SkuPopupLocaldata)\n// 按钮模式\nenum SkuMode {\n  Both = 1,\n  Cart = 2,\n  Buy = 3,\n}\nconst mode = ref<SkuMode>(SkuMode.Cart)\n// 打开SKU弹窗修改按钮模式\nconst openSkuPopup = (val: SkuMode) => {\n  // 显示SKU弹窗\n  isShowSku.value = true\n  // 修改按钮模式\n  mode.value = val\n}\n// SKU组件实例\nconst skuPopupRef = ref<SkuPopupInstance>()\n// 计算被选中的值\nconst selectArrText = computed(() => {\n  return skuPopupRef.value?.selectArr?.join(' ').trim() || '请选择商品规格'\n})\n// 加入购物车事件\nconst onAddCart = async (ev: SkuPopupEvent) => {\n  let res = await addCart({ userID: 103, skuID: ev._id, count: ev.buy_num })\n  if (res.code === 200) {\n    uni.showToast({ title: '添加成功' })\n    isShowSku.value = false\n  } else {\n    uni.showToast({ title: '添加失败' })\n  }\n}\n// 立即购买\nconst onBuyNow = (ev: SkuPopupEvent) => {\n  // uni.navigateTo({ url: `/pagesOrder/create/create?skuId=${ev._id}&count=${ev.buy_num}` })\n  let sku: any = []\n  sku.push({\n    id: ev._id,\n    count: ev.buy_num,\n    skuID: ev._id,\n    name: goods.value.productInfo.name,\n    pic: goods.value.productInfo.pic,\n    price: ev.price / 100,\n    tag: ev.sku_name_arr,\n    productId: goods.value.productInfo.id,\n  })\n  // 跳转到结算页\n  uni.navigateTo({\n    url: '/pages/orderCreate/index?sku=' + encodeURIComponent(JSON.stringify(sku)),\n  })\n}\n</script>\n\n<template>\n  <!-- SKU弹窗组件 -->\n  <vk-data-goods-sku-popup\n    v-model=\"isShowSku\"\n    :localdata=\"localdata\"\n    :mode=\"mode\"\n    add-cart-background-color=\"#FFA868\"\n    buy-now-background-color=\"#27BA9B\"\n    ref=\"skuPopupRef\"\n    :actived-style=\"{\n      color: '#27BA9B',\n      borderColor: '#27BA9B',\n      backgroundColor: '#E9F8F5',\n    }\"\n    @add-cart=\"onAddCart\"\n    @buy-now=\"onBuyNow\"\n  />\n  <scroll-view scroll-y class=\"viewport\">\n    <!-- 基本信息 -->\n    <view class=\"goods\">\n      <!-- 商品主图 -->\n      <view class=\"preview\">\n        <swiper @change=\"onChange\" circular>\n          <swiper-item v-for=\"item in goods?.imgUrl\" :key=\"item\">\n            <image class=\"image\" @tap=\"onTapImage(item)\" mode=\"aspectFill\" :src=\"item\" />\n          </swiper-item>\n        </swiper>\n        <view class=\"indicator\">\n          <text class=\"current\">{{ currentIndex + 1 }}</text>\n          <text class=\"split\">/</text>\n          <text class=\"total\">{{ goods?.imgUrl.length }}</text>\n        </view>\n      </view>\n\n      <!-- 商品简介 -->\n      <view class=\"meta\">\n        <view class=\"price\">\n          <text class=\"symbol\">¥</text>\n          <text class=\"number\">{{ goods?.productInfo.price }}</text>\n          <text class=\"xiaoliang\">已售 {{ goods?.productInfo.sale }}</text>\n        </view>\n        <view class=\"name ellipsis\">{{ goods?.productInfo.name }}</view>\n        <view class=\"desc\"> {{ goods?.productInfo.desc }} </view>\n      </view>\n\n      <!-- 操作面板 -->\n      <view class=\"action\">\n        <!-- <view class=\"item arrow\">\n          <text class=\"label\">选择</text>\n          <text class=\"text ellipsis\"> 请选择商品规格 </text>\n        </view>\n        <view class=\"item arrow\">\n          <text class=\"label\">送至</text>\n          <text class=\"text ellipsis\"> 请选择收获地址 </text>\n        </view> -->\n        <view class=\"item arrow\">\n          <text class=\"label\">服务</text>\n          <text class=\"text ellipsis\"> 无忧退 快速退款 免费包邮 </text>\n        </view>\n      </view>\n\n      <!-- 商品详情 -->\n      <view class=\"merchant\">\n        <image class=\"image\" :src=\"goods?.merchantInfo.pic\"></image>\n        <text class=\"info\">\n          <text class=\"name\">{{ goods?.merchantInfo.name }}</text>\n        </text>\n        <!-- <navigator class=\"button\" url=\"/pages/login/index\" open-type=\"navigate\"> 进店 </navigator> -->\n      </view>\n\n      <!-- 商品详情 -->\n      <view class=\"detail panel\">\n        <view class=\"title\">\n          <text>详情</text>\n        </view>\n        <view class=\"content\">\n          <view class=\"properties\">\n            <view class=\"properties\">\n              <!-- 属性详情 -->\n              <view class=\"item\" v-for=\"item in goods?.attributeList\" :key=\"item.name\">\n                <text class=\"label\">{{ item.name }}</text>\n                <text class=\"value\">{{ item.value }}</text>\n              </view>\n            </view>\n          </view>\n          <!-- 图片详情 -->\n          <image\n            class=\"image\"\n            v-for=\"item in goods?.introduceImgUrl\"\n            :key=\"item\"\n            mode=\"widthFix\"\n            :src=\"item\"\n          ></image>\n        </view>\n      </view>\n    </view>\n  </scroll-view>\n\n  <!-- 用户操作 -->\n  <view v-if=\"goods\" class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n    <view class=\"icons\">\n      <button class=\"icons-button\"><text class=\"icon-heart\"></text>收藏</button>\n\n      <button class=\"icons-button\" open-type=\"contact\">\n        <text class=\"icon-handset\"></text>客服\n      </button>\n\n      <navigator class=\"icons-button\" url=\"/pages/cart/cart2\" open-type=\"navigate\">\n        <text class=\"icon-cart\"></text>购物车\n      </navigator>\n    </view>\n    <view class=\"buttons\">\n      <view @tap=\"openSkuPopup(SkuMode.Cart)\" class=\"addcart\"> 加入购物车 </view>\n      <view @tap=\"openSkuPopup(SkuMode.Buy)\" class=\"payment\"> 立即购买 </view>\n    </view>\n  </view>\n\n  <!-- uni-ui 弹出层 -->\n  <uni-popup ref=\"popup\" type=\"bottom\" background-color=\"#fff\">\n    <AddressPanel v-if=\"popupName === 'address'\" @close=\"popup?.close()\" />\n    <ServicePanel v-if=\"popupName === 'service'\" @close=\"popup?.close()\" />\n  </uni-popup>\n</template>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n.viewport {\n  background-color: #f4f4f4;\n}\n\n.panel {\n  margin-top: 20rpx;\n  background-color: #fff;\n\n  .title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 90rpx;\n    line-height: 1;\n    padding: 30rpx 60rpx 30rpx 6rpx;\n    position: relative;\n\n    text {\n      padding-left: 10rpx;\n      font-size: 28rpx;\n      color: #333;\n      font-weight: 600;\n      border-left: 4rpx solid #27ba9b;\n    }\n\n    navigator {\n      font-size: 24rpx;\n      color: #666;\n    }\n  }\n}\n\n.arrow {\n  &::after {\n    position: absolute;\n    top: 50%;\n    right: 30rpx;\n    content: '\\e6c2';\n    color: #ccc;\n    font-family: 'erabbit' !important;\n    font-size: 32rpx;\n    transform: translateY(-50%);\n  }\n}\n\n/* 商品信息 */\n.goods {\n  background-color: #fff;\n\n  .preview {\n    height: 750rpx;\n    position: relative;\n\n    .image {\n      width: 750rpx;\n      height: 750rpx;\n    }\n\n    .indicator {\n      height: 40rpx;\n      padding: 0 24rpx;\n      line-height: 40rpx;\n      border-radius: 30rpx;\n      color: #fff;\n      font-family: Arial, Helvetica, sans-serif;\n      background-color: rgba(0, 0, 0, 0.3);\n      position: absolute;\n      bottom: 30rpx;\n      right: 30rpx;\n\n      .current {\n        font-size: 26rpx;\n      }\n\n      .split {\n        font-size: 24rpx;\n        margin: 0 1rpx 0 2rpx;\n      }\n\n      .total {\n        font-size: 24rpx;\n      }\n    }\n  }\n\n  .meta {\n    position: relative;\n    border-bottom: 1rpx solid #eaeaea;\n\n    .price {\n      height: 130rpx;\n      padding: 25rpx 30rpx 0;\n      color: #fff;\n      font-size: 34rpx;\n      box-sizing: border-box;\n      //background-color: #35c8a9;\n      background-color: #e49364;\n    }\n\n    .number {\n      font-size: 56rpx;\n    }\n\n    .xiaoliang {\n      float: right;\n      font-size: 26rpx;\n      margin-right: 20rpx;\n      margin-top: 20rpx;\n      color: #444;\n    }\n\n    .brand {\n      width: 160rpx;\n      height: 80rpx;\n      overflow: hidden;\n      position: absolute;\n      top: 26rpx;\n      right: 30rpx;\n    }\n\n    .name {\n      max-height: 88rpx;\n      line-height: 1.4;\n      margin: 20rpx;\n      font-size: 32rpx;\n      color: #333;\n    }\n\n    .desc {\n      line-height: 1;\n      padding: 0 20rpx 30rpx;\n      font-size: 24rpx;\n      color: #cf4444;\n    }\n  }\n\n  .action {\n    padding-left: 20rpx;\n\n    .item {\n      height: 90rpx;\n      padding-right: 60rpx;\n      border-bottom: 1rpx solid #eaeaea;\n      font-size: 26rpx;\n      color: #333;\n      position: relative;\n      display: flex;\n      align-items: center;\n\n      &:last-child {\n        border-bottom: 0 none;\n      }\n    }\n\n    .label {\n      width: 60rpx;\n      color: #898b94;\n      margin: 0 16rpx 0 10rpx;\n    }\n\n    .text {\n      flex: 1;\n      -webkit-line-clamp: 1;\n    }\n  }\n}\n\n/* 商家详情 */\n.merchant {\n  margin: 20rpx 0;\n  background-color: #f4f1f1;\n  padding: 20rpx 20rpx 20rpx 20px;\n  display: flex;\n  align-items: center;\n\n  .image {\n    width: 120rpx;\n    height: 120rpx;\n    border-radius: 50%;\n  }\n\n  .info {\n    margin-left: 30rpx;\n\n    .name {\n      height: 72rpx;\n      font-size: 32rpx;\n      color: #444;\n    }\n  }\n\n  .button {\n    margin-left: 28rpx;\n    font-size: 30rpx;\n    color: #444;\n    border-radius: 72rpx;\n    width: 140rpx;\n    border: 1rpx solid #ccc;\n    text-align: center;\n  }\n}\n\n/* 商品详情 */\n.detail {\n  padding-left: 20rpx;\n\n  .content {\n    margin-left: -20rpx;\n\n    .image {\n      width: 100%;\n    }\n  }\n\n  .properties {\n    padding: 0 20rpx;\n    margin-bottom: 30rpx;\n\n    .item {\n      display: flex;\n      line-height: 2;\n      padding: 10rpx;\n      font-size: 26rpx;\n      color: #333;\n      border-bottom: 1rpx dashed #ccc;\n    }\n\n    .label {\n      width: 200rpx;\n    }\n\n    .value {\n      flex: 1;\n    }\n  }\n}\n\n/* 同类推荐 */\n.similar {\n  .content {\n    padding: 0 20rpx 20rpx;\n    background-color: #f4f4f4;\n    display: flex;\n    flex-wrap: wrap;\n\n    .goods {\n      width: 340rpx;\n      padding: 24rpx 20rpx 20rpx;\n      margin: 20rpx 7rpx;\n      border-radius: 10rpx;\n      background-color: #fff;\n    }\n\n    .image {\n      width: 300rpx;\n      height: 260rpx;\n    }\n\n    .name {\n      height: 80rpx;\n      margin: 10rpx 0;\n      font-size: 26rpx;\n      color: #262626;\n    }\n\n    .price {\n      line-height: 1;\n      font-size: 20rpx;\n      color: #cf4444;\n    }\n\n    .number {\n      font-size: 26rpx;\n      margin-left: 2rpx;\n    }\n  }\n\n  navigator {\n    &:nth-child(even) {\n      margin-right: 0;\n    }\n  }\n}\n\n/* 底部工具栏 */\n.toolbar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: calc((var(--window-bottom)));\n  z-index: 1;\n  background-color: #fff;\n  height: 100rpx;\n  padding: 0 20rpx;\n  border-top: 1rpx solid #eaeaea;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: content-box;\n\n  .buttons {\n    display: flex;\n\n    & > view {\n      width: 220rpx;\n      text-align: center;\n      line-height: 72rpx;\n      font-size: 26rpx;\n      color: #fff;\n      border-radius: 72rpx;\n    }\n\n    .addcart {\n      background-color: #ffa868;\n    }\n\n    .payment {\n      background-color: #27ba9b;\n      margin-left: 20rpx;\n    }\n  }\n\n  .icons {\n    padding-right: 20rpx;\n    display: flex;\n    align-items: center;\n    flex: 1;\n\n    // 兼容 H5 端和 App 端的导航链接样式\n    .navigator-wrap,\n    .icons-button {\n      flex: 1;\n      text-align: center;\n      line-height: 1.4;\n      padding: 0;\n      margin: 0;\n      border-radius: 0;\n      font-size: 20rpx;\n      color: #333;\n      background-color: #fff;\n\n      &::after {\n        border: none;\n      }\n    }\n\n    text {\n      display: block;\n      font-size: 34rpx;\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/gygy/Desktop/毕业设计/SimplePick-Mall-UniUI/src/pages/goods/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getProductInfoAPI","onLoad","computed","addCart"],"mappings":"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"}